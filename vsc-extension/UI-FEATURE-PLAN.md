# RWXML æ‰©å±• UI åŠŸèƒ½å¼€å‘è®¡åˆ’

## åŠŸèƒ½æ¦‚è¿°

åœ¨ VS Code é¡¶éƒ¨æ ï¼ˆå¸®åŠ©èœå•åï¼‰æ·»åŠ ä¸€ä¸ªä¸‹æ‹‰èœå•ï¼Œæä¾›ä¸‰ä¸ªä¸»è¦åŠŸèƒ½ï¼š
1. **æ’ä»¶è®¾ç½®** - æ‰“å¼€ VS Code è®¾ç½®é¡µé¢
2. **ç¼“å­˜æ–‡ä»¶æŸ¥çœ‹** - æ˜¾ç¤ºå’Œç®¡ç†ç¼“å­˜æ–‡ä»¶
3. **é…ç½®èœå•** - UI ç•Œé¢ç¼–è¾‘é¡¹ç›®é…ç½®

## ç°æœ‰é…ç½®ç»“æ„

**rwxml-config.json** (é¡¹ç›®çº§é…ç½®)
```json
{
  "dllPaths": ["Assemblies/*.dll", "1.6/Assemblies/*.dll"],
  "includeVanillaData": true,
  "includeXmlPaths": ["Defs/**/*.xml", "1.6/Defs/**/*.xml"],
  "excludeXmlPaths": []
}
```

**ç¼“å­˜ä½ç½®**
- Windows: `%USERPROFILE%\.rwxml-cache\`
- å­˜å‚¨ä» DLL æå–çš„ç±»å‹ä¿¡æ¯

---

## ç¬¬ä¸€é˜¶æ®µï¼šé¡¶éƒ¨æ èœå• (Priority: High)

### 1.1 package.json é…ç½®

**æ–‡ä»¶**: `vsc-extension/package.json`

æ·»åŠ å‘½ä»¤å®šä¹‰ï¼š
```json
{
  "contributes": {
    "commands": [
      {
        "command": "rwxml.settings.open",
        "title": "RWXML: æ‰“å¼€è®¾ç½®"
      },
      {
        "command": "rwxml.cache.view",
        "title": "RWXML: æŸ¥çœ‹ç¼“å­˜æ–‡ä»¶"
      },
      {
        "command": "rwxml.config.edit",
        "title": "RWXML: ç¼–è¾‘é¡¹ç›®é…ç½®"
      }
    ],
    "menus": {
      "commandPalette": [
        {
          "command": "rwxml.settings.open",
          "when": "true"
        },
        {
          "command": "rwxml.cache.view",
          "when": "true"
        },
        {
          "command": "rwxml.config.edit",
          "when": "true"
        }
      ],
      "extension/context": [
        // é¡¶éƒ¨æ èœå•
      ]
    }
  }
}
```

### 1.2 åˆ›å»ºä¸»æ§åˆ¶å™¨

**æ–‡ä»¶**: `vsc-extension/src/ui/menuController.ts`

èŒè´£ï¼š
- æ³¨å†Œæ‰€æœ‰å‘½ä»¤
- ç®¡ç†èœå•çŠ¶æ€
- åè°ƒå„ä¸ª UI æ¨¡å—

---

## ç¬¬äºŒé˜¶æ®µï¼šæ’ä»¶è®¾ç½® (Priority: Low)

### å®ç°ç®€å•è·³è½¬

**æ–‡ä»¶**: `vsc-extension/src/ui/settingsHandler.ts`

åŠŸèƒ½ï¼š
- æ‰§è¡Œ `vscode.commands.executeCommand('workbench.action.openSettings', '@ext:rwxml-language-server')`
- è·³è½¬åˆ°æ‰©å±•è®¾ç½®é¡µé¢

---

## ç¬¬ä¸‰é˜¶æ®µï¼šç¼“å­˜æ–‡ä»¶æŸ¥çœ‹å™¨ (Priority: High)

### 3.1 åˆ›å»º TreeDataProvider

**æ–‡ä»¶**: `vsc-extension/src/ui/cacheTreeProvider.ts`

æ˜¾ç¤ºç»“æ„ï¼š
```
ğŸ“ RWXML ç¼“å­˜
â”œâ”€â”€ ğŸ“‚ å·²å¯ç”¨çš„é¡¹ç›®
â”‚   â”œâ”€â”€ ğŸ“¦ MyMod (1.2 MB, 2024-12-26)
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Assembly-CSharp.dll.cache
â”‚   â”‚   â””â”€â”€ ğŸ“„ UnityEngine.dll.cache
â”‚   â””â”€â”€ ğŸ“¦ AnotherMod (800 KB, 2024-12-25)
â””â”€â”€ ğŸ“‚ æœªå¯ç”¨çš„é¡¹ç›®
    â”œâ”€â”€ ğŸ“¦ OldMod (500 KB, 2024-12-20)
    â””â”€â”€ ğŸ“¦ TestMod (100 KB, 2024-12-15)
```

**æ•°æ®ç»“æ„**ï¼š
```typescript
interface CacheItem {
  name: string
  size: number
  modified: Date
  path: string
  isEnabled: boolean // é¡¹ç›®æ˜¯å¦åœ¨å½“å‰å·¥ä½œåŒº
}

interface CacheFolder {
  name: string
  items: CacheItem[]
}
```

### 3.2 åˆ›å»ºç¼“å­˜ç®¡ç†æœåŠ¡

**æ–‡ä»¶**: `vsc-extension/src/ui/cacheManager.ts`

åŠŸèƒ½ï¼š
- æ‰«æç¼“å­˜ç›®å½•
- è·å–æ–‡ä»¶ä¿¡æ¯ï¼ˆå¤§å°ã€ä¿®æ”¹æ—¶é—´ï¼‰
- åˆ¤æ–­é¡¹ç›®æ˜¯å¦å¯ç”¨
- åˆ é™¤ç¼“å­˜
- é‡æ–°ç”Ÿæˆç¼“å­˜ï¼ˆè°ƒç”¨ language-serverï¼‰

### 3.3 TreeItem ä¸Šä¸‹æ–‡èœå•

æ¯ä¸ªç¼“å­˜æ–‡ä»¶çš„å³é”®èœå•ï¼š
- ğŸ—‘ï¸ åˆ é™¤ç¼“å­˜
- ğŸ”„ é‡æ–°ç”Ÿæˆ
- ğŸ“‚ æ‰“å¼€æ‰€åœ¨æ–‡ä»¶å¤¹

---

## ç¬¬å››é˜¶æ®µï¼šé…ç½®ç¼–è¾‘å™¨ (Priority: High)

### 4.1 åˆ›å»º Webview Panel

**æ–‡ä»¶**: `vsc-extension/src/ui/configEditorPanel.ts`

UI å¸ƒå±€ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RWXML é¡¹ç›®é…ç½®ç¼–è¾‘å™¨    ğŸ’¾ ä¿å­˜         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  DLL è·¯å¾„é…ç½®                   [+ æ·»åŠ ]  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Assemblies/*.dll          [Ã—]   â”‚   â”‚
â”‚  â”‚ 1.6/Assemblies/*.dll      [Ã—]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                          â”‚
â”‚  XML åŒ…å«è·¯å¾„                 [+ æ·»åŠ ]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Defs/**/*.xml             [Ã—]   â”‚   â”‚
â”‚  â”‚ 1.6/Defs/**/*.xml         [Ã—]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                          â”‚
â”‚  XML æ’é™¤è·¯å¾„                 [+ æ·»åŠ ]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ **/Tests/**/*.xml          [Ã—]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                          â”‚
â”‚  â˜‘ åŒ…å«æœ¬ä½“æ•°æ®                          â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 è¾“å…¥éªŒè¯

- DLL è·¯å¾„ï¼šæ”¯æŒ glob æ¨¡å¼ï¼Œå¿…é¡»ä»¥ `.dll` ç»“å°¾
- XML è·¯å¾„ï¼šæ”¯æŒ glob æ¨¡å¼ï¼Œå¿…é¡»ä»¥ `.xml` ç»“å°¾
- è·¯å¾„æ ¡éªŒï¼šæ˜¾ç¤ºæ— æ•ˆè·¯å¾„è­¦å‘Š

### 4.3 ä¿å­˜é€»è¾‘

- ä¿å­˜åˆ° `rwxml-config.json`
- ä¿å­˜å‰éªŒè¯ JSON æ ¼å¼
- ä¿å­˜åæç¤ºç”¨æˆ·é‡æ–°åŠ è½½çª—å£

### 4.4 é€šä¿¡åè®®

**ä» Webview åˆ° Extension**ï¼š
```typescript
// ä¿å­˜é…ç½®
{ type: 'save', config: ProjectConfig }

// éªŒè¯è·¯å¾„
{ type: 'validate', path: string, patternType: 'dll' | 'xml' }

// å…³é—­é¢æ¿
{ type: 'close' }
```

**ä» Extension åˆ° Webview**ï¼š
```typescript
// é…ç½®å·²æ›´æ–°
{ type: 'configUpdated', config: ProjectConfig }

// éªŒè¯ç»“æœ
{ type: 'validateResult', path: string, valid: boolean, error?: string }
```

### 4.5 åˆ›å»º Webview å†…å®¹

**æ–‡ä»¶**: `vsc-extension/src/ui/configEditor.html`

ä½¿ç”¨ï¼š
- åŸç”Ÿ HTML/CSS/JavaScriptï¼ˆæ— éœ€é¢å¤–ä¾èµ–ï¼‰
- VS Code Codicons å›¾æ ‡
- å“åº”å¼å¸ƒå±€

---

## ç¬¬äº”é˜¶æ®µï¼šä¸ Language Server é€šä¿¡ (Priority: Medium)

### 5.1 æ·»åŠ  LSP è‡ªå®šä¹‰é€šçŸ¥

**æ–‡ä»¶**: `language-server/src/events.ts`

æ·»åŠ äº‹ä»¶ï¼š
```typescript
export const CacheRegenerate = 'rwxml/cache/regenerate'
export const CacheDelete = 'rwxml/cache/delete'
export const CacheList = 'rwxml/cache/list'
```

### 5.2 å®ç°æœåŠ¡ç«¯å¤„ç†

**æ–‡ä»¶**: `language-server/src/cacheManager.ts`

åŠŸèƒ½ï¼š
- å¤„ç†ç¼“å­˜é‡æ–°ç”Ÿæˆè¯·æ±‚
- å¤„ç†ç¼“å­˜åˆ é™¤è¯·æ±‚
- è¿”å›ç¼“å­˜åˆ—è¡¨ä¿¡æ¯

---

## æ–‡ä»¶ç»“æ„

```
vsc-extension/src/
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ menuController.ts        # ä¸»èœå•æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ settingsHandler.ts       # è®¾ç½®é¡µé¢è·³è½¬
â”‚   â”œâ”€â”€ cacheTreeProvider.ts     # ç¼“å­˜æ ‘è§†å›¾
â”‚   â”œâ”€â”€ cacheManager.ts          # ç¼“å­˜ç®¡ç†æœåŠ¡
â”‚   â”œâ”€â”€ configEditorPanel.ts     # é…ç½®ç¼–è¾‘å™¨ Panel
â”‚   â”œâ”€â”€ configEditor.html        # ç¼–è¾‘å™¨ HTML
â”‚   â””â”€â”€ styles/
â”‚       â””â”€â”€ configEditor.css     # ç¼–è¾‘å™¨æ ·å¼
â”œâ”€â”€ index.ts                     # æ³¨å†Œæ‰€æœ‰ UI æ¨¡å—
```

---

## å®æ–½é¡ºåº

1. âœ… **Week 1**: åŸºç¡€èœå•ç»“æ„
   - æ·»åŠ  package.json å‘½ä»¤
   - åˆ›å»º menuController
   - å®ç°è®¾ç½®è·³è½¬ï¼ˆæœ€ç®€å•ï¼‰

2. âœ… **Week 2**: é…ç½®ç¼–è¾‘å™¨
   - åˆ›å»º Webview Panel
   - å®ç° UI ç•Œé¢
   - å®ç°ä¿å­˜é€»è¾‘
   - æ·»åŠ è·¯å¾„éªŒè¯

3. âœ… **Week 3**: ç¼“å­˜æŸ¥çœ‹å™¨
   - åˆ›å»º TreeDataProvider
   - å®ç°ç¼“å­˜æ‰«æ
   - æ·»åŠ ä¸Šä¸‹æ–‡èœå•
   - å®ç°åˆ é™¤å’Œé‡æ–°ç”ŸæˆåŠŸèƒ½

4. âœ… **Week 4**: é›†æˆæµ‹è¯•
   - ç«¯åˆ°ç«¯æµ‹è¯•
   - ä¿®å¤ bug
   - æ€§èƒ½ä¼˜åŒ–

---

## æŠ€æœ¯è¦ç‚¹

### VS Code API ä½¿ç”¨

1. **TreeView**
   ```typescript
   vscode.window.createTreeView('rwxml.cacheView', {
     treeDataProvider: cacheTreeProvider
   })
   ```

2. **Webview Panel**
   ```typescript
   vscode.window.createWebviewPanel(
     'rwxml.configEditor',
     'RWXML é…ç½®ç¼–è¾‘å™¨',
     vscode.ViewColumn.One,
     { enableScripts: true }
   )
   ```

3. **Language Client é€šä¿¡**
   ```typescript
   client.sendNotification('rwxml/cache/regenerate', { dllPath })
   ```

### æ ·å¼è§„èŒƒ

- ä½¿ç”¨ VS Code ä¸»é¢˜å˜é‡ï¼ˆ`--vscode-editor-background` ç­‰ï¼‰
- å“åº”å¼å¸ƒå±€ï¼ˆæ”¯æŒä¸åŒçª—å£å¤§å°ï¼‰
- æ— éšœç¢æ”¯æŒï¼ˆé”®ç›˜å¯¼èˆªã€ARIA æ ‡ç­¾ï¼‰

---

## ä¾èµ–é¡¹æ£€æŸ¥æ¸…å•

- [ ] ç¡®è®¤ language-server æ˜¯å¦å·²æœ‰ç¼“å­˜ç®¡ç† API
- [ ] ç¡®è®¤ç¼“å­˜ç›®å½•è·¯å¾„æ˜¯å¦åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸€è‡´
- [ ] ç¡®è®¤é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯å¦éœ€è¦å‘åå…¼å®¹
- [ ] ç¡®è®¤æ˜¯å¦éœ€è¦æ·»åŠ é…ç½®è¿ç§»é€»è¾‘

---

## æµ‹è¯•è®¡åˆ’

1. **å•å…ƒæµ‹è¯•**
   - é…ç½®æ–‡ä»¶è¯»å†™
   - è·¯å¾„éªŒè¯é€»è¾‘
   - ç¼“å­˜æ‰«æåŠŸèƒ½

2. **é›†æˆæµ‹è¯•**
   - é…ç½®ä¿å­˜åæ˜¯å¦ç”Ÿæ•ˆ
   - ç¼“å­˜é‡æ–°ç”Ÿæˆæ˜¯å¦æˆåŠŸ
   - å¤šå·¥ä½œåŒºåœºæ™¯

3. **UI æµ‹è¯•**
   - Webview åœ¨ä¸åŒä¸»é¢˜ä¸‹çš„æ˜¾ç¤º
   - TreeView åŠ è½½æ€§èƒ½ï¼ˆå¤§é‡ç¼“å­˜æ–‡ä»¶ï¼‰
   - é”®ç›˜å¿«æ·é”®

---

## æœªæ¥æ‰©å±•

- [ ] é…ç½®æ¨¡æ¿ï¼ˆå¿«é€Ÿåˆ›å»ºå¸¸è§é…ç½®ï¼‰
- [ ] é…ç½®å¯¼å…¥/å¯¼å‡º
- [ ] ç¼“å­˜ä½¿ç”¨ç»Ÿè®¡ï¼ˆå“ªäº› DLL æœ€å¸¸ä½¿ç”¨ï¼‰
- [ ] è‡ªåŠ¨æ¸…ç†è¿‡æœŸç¼“å­˜ï¼ˆè¶…è¿‡ 30 å¤©æœªä½¿ç”¨ï¼‰
- [ ] é…ç½®éªŒè¯å»ºè®®ï¼ˆæ£€æµ‹å¯èƒ½çš„é…ç½®é”™è¯¯ï¼‰

---

## å¤‡æ³¨

- æ‰€æœ‰ UI æ–‡æœ¬æ”¯æŒä¸­è‹±æ–‡åŒè¯­ï¼ˆä½¿ç”¨ vscode.l10nï¼‰
- é”™è¯¯ä¿¡æ¯è¦å‹å¥½ï¼Œé¿å…æŠ€æœ¯æœ¯è¯­
- æ•æ„Ÿæ“ä½œï¼ˆåˆ é™¤ç¼“å­˜ï¼‰éœ€è¦ç¡®è®¤å¯¹è¯æ¡†
- æ‰€æœ‰å¼‚æ­¥æ“ä½œè¦æœ‰åŠ è½½çŠ¶æ€æç¤º
