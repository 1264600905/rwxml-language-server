# XML 自动化校验工具构想

## 核心目标
构建一个能够解析 RimWorld 原版 XML 并对 MOD XML 进行深度校验的自动化工具。不仅检查语法错误（Syntax），更要检查逻辑引用错误（Reference Integrity）。

## 现状分析 (2024-2025)
- **RWXML Language Server**: 已停止维护 (Archived)，不支持 1.5 版本，但其 `extractor` 模块具有极高的复用价值。
- **VS Code 插件**: 目前主流方案是 "XML Language Support by Red Hat" + 手动配置 XSD，无法进行引用检查。
- **现有痛点**: 缺乏独立的、基于真实游戏数据的、可集成到 CI/CD 流程中的校验工具。

## 技术路线图

### 第一阶段：元数据提取 (The Extractor)
**核心思想**: 不要硬编码规则，而是从游戏 DLL 中提取规则。
**方案**: 复用并改造 `rwxml-language-server/extractor` 项目。
1.  **环境**: C# / .NET
2.  **输入**: RimWorld 游戏目录 (`RimWorldWin64_Data/Managed`)
3.  **逻辑**: 
    - 加载 `Assembly-CSharp.dll`。
    - 递归扫描所有继承自 `Verse.Def` 的类。
    - 提取字段名称、类型、是否必填等信息。
4.  **输出**: `rimworld-defs-metadata.json` (包含所有 Def 的结构指纹)。

### 第二阶段：校验器核心 (The Validator)
**方案**: 基于 JSON 元数据的静态分析器。
**输入**: 用户编写的 XML 文件 + `rimworld-defs-metadata.json`。
**功能**:
1.  **结构校验**: 检查 XML 标签是否存在于对应的 C# 类中（例如 `<spped>` vs `<speed>`）。
2.  **引用校验**: 检查 `<damageDef>Nuclear</damageDef>` 中的 `Nuclear` 是否在数据库中存在。
3.  **类型检查**: 检查数值是否越界、枚举值是否合法。

### 第三阶段：工程化与集成
1.  封装为 CLI 工具（`rimlint`）。
2.  集成到 `deploy.ps1` 工作流中。
3.  (可选) 为 VS Code 开发新的轻量级 Linter 插件。

## 下一步行动计划
1.  在新的对话会话中，专注于 `XML自动化工具/rwxml-language-server-master/extractor` 的复活工作。
2.  尝试使用 `dotnet build` 编译该项目。
3.  配置路径，运行提取器生成第一份 1.5 版本的元数据 JSON。